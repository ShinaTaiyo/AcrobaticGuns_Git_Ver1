//==================================================================================================================================
//
//６月１６日：ゲージを実装
//Author:ShinaTaiyo
//
//==================================================================================================================================

//===================================================================
//インクルード
//===================================================================
#include "gauge.h"
#include "texture.h"
//==================================================================================================================================

//===================================================================
//コンストラクタ
//===================================================================
CGauge::CGauge(int nPri, bool bUseintPri, CObject::TYPE type, CObject::OBJECTTYPE ObjType) : CObject2D(nPri,bUseintPri,type,ObjType),
m_nParam(0),m_nParamOld(0),m_type(GAUGETYPE::PLAYERHP),m_nMaxParam(0)
{

}
//==================================================================================================================================

//===================================================================
//デストラクタ
//===================================================================
CGauge::~CGauge()
{

}
//==================================================================================================================================

//===================================================================
//初期化処理
//===================================================================
HRESULT CGauge::Init()
{
	CObject2D::Init();        //2Dオブジェクト初期化
	return S_OK;
}
//==================================================================================================================================


//===================================================================
//終了処理
//===================================================================
void CGauge::Uninit()
{
	CObject2D::Uninit();//2Dオブジェクト終了
}
//==================================================================================================================================

//===================================================================
//更新処理
//===================================================================
void CGauge::Update()
{
	float fRatio;//現在のゲージの割合
	float fMaxWidth = GetMaxWidth();//2Dオブジェクトの横幅の最大値を取得する

	if (m_nParam > m_nMaxParam)
	{//パラメータが最大値を超えていたら、最大値に固定。
		m_nParam = m_nMaxParam;
	}

	fRatio = (float)(m_nParam) / (float)(m_nMaxParam);

	SetWidth(fMaxWidth * fRatio);

	CObject2D::Update();
}
//==================================================================================================================================

//===================================================================
//描画処理
//===================================================================
void CGauge::Draw()
{
	CObject2D::Draw();//2Dオブジェクト描画処理
}
//==================================================================================================================================

//===================================================================
//パラメータを増加させる
//===================================================================
void CGauge::AddParam(int nParam)
{
	m_nParam += nParam;
}
//==================================================================================================================================

//===================================================================
//死亡フラグを設定
//===================================================================
void CGauge::SetDeath()
{
	CObject::SetDeath();
}
//==================================================================================================================================

//===================================================================
//パラメータを設定
//===================================================================
void CGauge::SetParam(int nParam)
{
	m_nParamOld = m_nParam;//一つ前のパラメータを設定
	m_nParam = nParam;
	int nDamage = m_nParamOld - m_nParam;//一つ前のパラメータを比べる
	float fRatio = (float)(m_nParam) / (float)(m_nMaxParam);//現在のゲージの割合
	float fMaxWidth = GetMaxWidth();//2Dオブジェクトの横幅の最大値を取得する
	float fDamageRatio = 1.0f - fRatio;
	float fWidth = fMaxWidth * fRatio;
	SetWidth(fWidth);
}
//==================================================================================================================================

//===================================================================
//生成処理
//===================================================================
CGauge * CGauge::Create(GAUGETYPE type, int nParam, float fWidth, float fHeight, D3DXVECTOR3 pos)
{
	CGauge* pGauge = DBG_NEW CGauge;                             //弾を生成
	pGauge->Init();                                                                                 //初期化処理
	pGauge->SetUseDeath(false);                                                                     //死亡フラグを発動するかどうかを設定する
	pGauge->m_type = type;                                                                          //弾の種類
	pGauge->m_nParam = nParam;                                                                      //パラメータ
	pGauge->m_nMaxParam = nParam;                                                                   //最大パラメータ
	pGauge->SetPos(pos);
	pGauge->SetInfo(0, 0, fWidth, fHeight, D3DXCOLOR(0.0f, 0.0f, 1.0f, 1.0f), CObject2D::POLYGONTYPE::LEFT, false);
	return pGauge;
}
//==================================================================================================================================